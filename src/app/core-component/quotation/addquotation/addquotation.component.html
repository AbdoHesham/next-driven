<div class="page-header">
  <div class="page-title">
    <h4>{{ "Manage your Quotations" | translate }}</h4>
    <h6>{{ "Add/Update  Quotations " | translate }}</h6>
  </div>
</div>
<!-- /add -->
<div class="card">
  <div class="card-body">
    <form [formGroup]="Form">
      <div class="row">
        <div class="col-lg-4 col-sm-6 col-12">
          <div class="form-group">
            <label>{{ "Customer Name" | translate }}* </label>

            <select
              class="form-select"
              id="selectCountry"
              formControlName="customerID"
            >
              <option
                *ngFor="let country of customers"
                [value]="country.id"
                class="custom-option"
              >
                {{ country.fullName }}
              </option>
            </select>
            <!-- <button
              class="btn btn-submit"
              style="width: 126px; height: 41px; margin-left: 13px; padding: 0"
            >
              {{ "Add" | translate }}
            </button> -->
            <mat-hint>{{ "Select Customer or" | translate }} </mat-hint>
            <span>
              <a style="color: blue" (click)="showNewCustomerInputsFun()">
                {{ "Add New Customer" | translate }}
              </a>
            </span>
            <div *ngIf="Form.get('name')?.touched && Form.get('name')?.errors">
              <div *ngIf="Form.get('name')?.errors?.['required']">
                <span class="text-danger">
                  {{ "this field is required" | translate }}
                </span>
              </div>
              <div *ngIf="Form.get('name')?.errors?.['minlength']">
                <span class="text-danger">
                  {{ "minlength is 3 character" | translate }}
                </span>
              </div>
              <div *ngIf="Form.get('name')?.errors?.['maxlength']">
                <span class="text-danger">
                  {{ "maxlength is 50 character" | translate }}
                </span>
              </div>
              <div *ngIf="Form.get('name')?.errors?.['pattern']">
                <span class="text-danger">
                  {{ "Enter characters only" | translate }}
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4 col-sm-6 col-12" *ngIf="showNewCustomerInputs">
          <div class="form-group">
            <label> {{ "First Name" | translate }} </label>
            <input type="text" name="firstName" formControlName="firstName" />
            <div
              *ngIf="
                Form.get('firstName')?.touched && Form.get('firstName')?.errors
              "
            >
              <!-- <div *ngIf="Form.get('firstName')?.errors?.['required']">
                <span class="text-danger">
                  {{ "this field is required" | translate }}
                </span>
              </div> -->
            </div>
          </div>
        </div>

        <div class="col-lg-4 col-sm-6 col-12" *ngIf="showNewCustomerInputs">
          <div class="form-group">
            <label> {{ "Last Name" | translate }}</label>
            <input type="text" name="LastName" formControlName="LastName" />
            <div
              *ngIf="
                Form.get('LastName')?.touched && Form.get('LastName')?.errors
              "
            >
              <div *ngIf="Form.get('LastName')?.errors?.['required']">
                <span class="text-danger">
                  {{ "this field is required" | translate }}
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4 col-sm-6 col-12" *ngIf="showNewCustomerInputs">
          <div class="form-group">
            <label> {{ "Email" | translate }} </label>
            <input type="text" name="Email" formControlName="Email" />
            <div
              *ngIf="Form.get('Email')?.touched && Form.get('Email')?.errors"
            >
              <div *ngIf="Form.get('Email')?.errors?.['required']">
                <span class="text-danger">
                  {{ "this field is required" | translate }}
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4 col-sm-6 col-12">
          <div class="form-group">
            <label> {{ "Reward Balance" | translate }} *</label>
            <input
              type="text"
              name="Rewardbalance"
              formControlName="Rewardbalance"
            />
            <div
              *ngIf="
                Form.get('Rewardbalance')?.touched &&
                Form.get('Rewardbalance')?.errors
              "
            >
              <div *ngIf="Form.get('Rewardbalance')?.errors?.['required']">
                <span class="text-danger">
                  {{ "this field is required" | translate }}
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4 col-sm-6 col-12">
          <div class="form-group">
            <label> {{ "VAT Number" | translate }} *</label>
            <input type="text" name="VATNumber" formControlName="VATNumber" />
            <div
              *ngIf="
                Form.get('VATNumber')?.touched && Form.get('VATNumber')?.errors
              "
            >
              <div *ngIf="Form.get('VATNumber')?.errors?.['required']">
                <span class="text-danger">
                  {{ "this field is required" | translate }}
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4 col-sm-6 col-12">
          <div class="form-group">
            <label>{{ "Country" | translate }} *</label>

            <select
              class="form-select custom-select"
              id="selectCountry"
              formControlName="countryID"
            >
              <option
                *ngFor="let country of countries"
                [value]="country.id"
                class="custom-option"
              >
                {{ country.name }}
              </option>
            </select>
            <div
              *ngIf="
                Form.get('countryID')?.touched && Form.get('countryID')?.errors
              "
            >
              <div *ngIf="Form.get('countryID')?.errors?.['required']">
                <span class="text-danger">
                  {{ "this field is required" | translate }}
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4 col-sm-6 col-12">
          <div class="form-group">
            <label>{{ "City" | translate }} *</label>

            <select
              class="form-select"
              id="selectCity"
              formControlName="cityID"
            >
              <option
                *ngFor="let city of cities"
                [value]="city.id"
                class="custom-option"
              >
                {{ city.name }}
              </option>
            </select>
            <div
              *ngIf="Form.get('cityID')?.touched && Form.get('cityID')?.errors"
            >
              <div *ngIf="Form.get('cityID')?.errors?.['required']">
                <span class="text-danger">
                  {{ "this field is required" | translate }}
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4 col-sm-6 col-12">
          <div class="form-group">
            <label> {{ "Street" | translate }} * </label>
            <input
              type="text"
              name="Street"
              formControlName="streetName"
              required
            />
            <div
              *ngIf="
                Form.get('streetName')?.touched &&
                Form.get('streetName')?.errors
              "
            >
              <div *ngIf="Form.get('streetName')?.errors?.['required']">
                <span class="text-danger">
                  {{ "this field is required" | translate }}
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4 col-sm-6 col-12">
          <div class="form-group">
            <label>{{ "Building Number" | translate }} *</label>
            <input
              type="text"
              name="BuildingNumber"
              formControlName="buildingNumber"
              required
            />
            <div
              *ngIf="
                Form.get('buildingNumber')?.touched &&
                Form.get('buildingNumber')?.errors
              "
            >
              <div *ngIf="Form.get('buildingNumber')?.errors?.['required']">
                <span class="text-danger">
                  {{ "this field is required" | translate }}
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4 col-sm-6 col-12">
          <div class="form-group">
            <label>{{ "Postal Code" | translate }} *</label>
            <input
              type="text"
              name="PostalCode"
              formControlName="PostalCode"
              required
            />
            <div
              *ngIf="
                Form.get('PostalCode')?.touched &&
                Form.get('PostalCode')?.errors
              "
            >
              <div *ngIf="Form.get('PostalCode')?.errors?.['required']">
                <span class="text-danger">
                  {{ "this field is required" | translate }}
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4 col-sm-6 col-12">
          <div class="form-group">
            <label>{{ "District" | translate }} *</label>
            <select
              class="form-select"
              id="selectDistrict"
              formControlName="districtID"
            >
              <option
                *ngFor="let district of districts"
                [value]="district.id"
                class="custom-option"
              >
                {{ district.name }}
              </option>
            </select>

            <div
              *ngIf="
                Form.get('districtID')?.touched &&
                Form.get('districtID')?.errors
              "
            >
              <div *ngIf="Form.get('districtID')?.errors?.['required']">
                <span class="text-danger">
                  {{ "this field is required" | translate }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-4 col-sm-6 col-12">
          <div class="form-group">
            <label>{{ "Quotation Issued Date" | translate }}*</label>

            <div class="input-groupicon">
              <ngx-datepicker
                formControlName="QuotationIssuedDate"
                name="QuotationIssuedDate"
              ></ngx-datepicker>

              <div class="addonset">
                <img src="assets/img/icons/calendars.svg" alt="img" />
              </div>
            </div>
            <div
              *ngIf="
                Form.get('QuotationIssuedDate')?.touched &&
                Form.get('QuotationIssuedDate')?.errors
              "
            >
              <div
                *ngIf="Form.get('QuotationIssuedDate')?.errors?.['required']"
              >
                <span class="text-danger">
                  {{ "this field is required" | translate }}
                </span>
              </div>
              <div *ngIf="Form.get('QuotationIssuedDate')?.errors?.['pattern']">
                <span>
                  {{ "Enter Digits only" | translate }}
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4 col-sm-6 col-12">
          <div class="form-group">
            <label>{{ "Quotation Expiry Date" | translate }}*</label>

            <div class="input-groupicon">
              <ngx-datepicker
                formControlName="QuotationExpiryDate"
                name="QuotationExpiryDate"
              ></ngx-datepicker>

              <div class="addonset">
                <img src="assets/img/icons/calendars.svg" alt="img" />
              </div>
            </div>
            <div
              *ngIf="
                Form.get('QuotationExpiryDate')?.touched &&
                Form.get('QuotationExpiryDate')?.errors
              "
            >
              <div
                *ngIf="Form.get('QuotationExpiryDate')?.errors?.['required']"
              >
                <span class="text-danger">
                  {{ "this field is required" | translate }}
                </span>
              </div>
              <div *ngIf="Form.get('QuotationExpiryDate')?.errors?.['pattern']">
                <span>
                  {{ "Enter Digits only" | translate }}
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4 col-sm-6 col-12">
          <div class="form-group">
            <label>{{ "Quotation Reference Number" | translate }}*</label>
            <input
              type="text"
              name="QuotationReferenceNumber"
              formControlName="QuotationReferenceNumber"
              required
            />
            <div
              *ngIf="
                Form.get('QuotationReferenceNumber')?.touched &&
                Form.get('QuotationReferenceNumber')?.errors
              "
            >
              <div
                *ngIf="Form.get('QuotationReferenceNumber')?.errors?.['required']"
              >
                <span class="text-danger">
                  {{ "this field is required" | translate }}
                </span>
              </div>
              <div
                *ngIf="Form.get('QuotationReferenceNumber')?.errors?.['pattern']"
              >
                <span>
                  {{ "Enter Digits only" | translate }}
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-12 col-sm-6 col-12">
            <div class="form-group">
              <mat-form-field class="p-relative">
                <mat-label>{{ "Search by Purchase" | translate }}</mat-label>
                <mat-select
                  matNativeControl
                  formControlName="itemsFilterCtrl"
                  placeholder="items"
                  #singleSelect
                  (selectionChange)="onSelectitem($event)"
                  multiple
                >
                  <mat-option>
                    <ngx-mat-select-search
                      [formControl]="itemsCtrl"
                      [placeholderLabel]="'search ...' | translate"
                      [noEntriesFoundLabel]="'no search result' | translate"
                      (keyup)="searchItemsList($event)"
                    ></ngx-mat-select-search>
                  </mat-option>
                  <mat-option *ngFor="let item of altitemsList" [value]="item">
                    {{ item.itemName }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
        </div>
      </div>
    </form>
    <!-- <div class="row"> -->

    <div class="row">
      <div class="table-responsive">
        <table mat-table [dataSource]="filteredData" class="mat-elevation-z8">
          <ng-container *ngFor="let column of columns">
            <ng-container
              *ngIf="column.type === 'text'"
              [matColumnDef]="column.property"
            >
              <th *matHeaderCellDef class="uppercase" mat-header-cell>
                {{ column.label | translate }}
              </th>
              <td *matCellDef="let row" mat-cell>
                {{
                  row[column.property] == null ? "N/A" : row[column.property]
                }}
              </td>
            </ng-container>
          </ng-container>
          <ng-container *ngFor="let column of columns">
            <ng-container
              *ngIf="column.type === 'array2'"
              [matColumnDef]="column.property"
            >
              <th *matHeaderCellDef class="uppercase" mat-header-cell>
                {{ column.label | translate }}
              </th>
              <td *matCellDef="let row" mat-cell>
                <input
                  mat-input
                  type="number"
                  class="form-control input-value"
                  #inp
                  name="Street"
                  style="height: 33px"
                  (keyup)="handleNumInp(inp.value, row, 'Quantity')"
                  placeholder="Needed Quantity"
                  [value]="row[column.property]"
                />
              </td>
            </ng-container>
          </ng-container>
          <ng-container *ngFor="let column of columns">
            <ng-container
              *ngIf="column.type === 'array3'"
              [matColumnDef]="column.property"
            >
              <th *matHeaderCellDef class="uppercase" mat-header-cell>
                {{ column.label | translate }}
              </th>
              <td *matCellDef="let row" mat-cell>
                <input
                  mat-input
                  type="number"
                  class="form-control input-value"
                  #inp
                  name="Street"
                  style="height: 33px"
                  (keyup)="handleNumInp(inp.value, row, 'price')"
                  placeholder="Needed Price"
                  [value]="row[column.property]"
                />
              </td>
            </ng-container>
          </ng-container>
          <ng-container *ngFor="let column of columns">
            <ng-container
              *ngIf="column.type === 'array4'"
              [matColumnDef]="column.property"
            >
              <th *matHeaderCellDef class="uppercase" mat-header-cell>
                {{ column.label | translate }}
              </th>
              <td *matCellDef="let row" mat-cell>
                <input
                  mat-input
                  type="number"
                  class="form-control input-value"
                  #inp
                  name="Street"
                  style="height: 33px"
                  (keyup)="handleNumInp(inp.value, row, 'vatPercentage')"
                  placeholder="Vat Percentage"
                  [value]="row[column.property]"
                />
              </td>
            </ng-container>
          </ng-container>
          <ng-container *ngFor="let column of columns">
            <ng-container
              *ngIf="column.type === 'button'"
              [matColumnDef]="column.property"
            >
              <th *matHeaderCellDef class="uppercase" mat-header-cell>
                {{ column.label | translate }}
              </th>
              <td *matCellDef="let row" mat-cell>
                <a class="me-3 confirm-text" (click)="delete(row?.id)">
                  <img src="assets/img/icons/delete.svg" alt="img" />
                </a>
              </td>
            </ng-container>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="visibleColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: visibleColumns"></tr>
        </table>
        <div *ngIf="filteredData?.length < 1" class="text-center">
          <h2>{{ "No items added yet" | translate }}</h2>
        </div>
      </div>
    </div>
    <!-- </div> -->
    <div class="row mt-5">
      <div class="col-lg-12">
        <!-- [disabled]="Form.invalid" -->
        <button (click)="submit()"  class="btn btn-submit me-2">
          {{ "Submit" | translate }}
        </button>
        <a class="btn btn-cancel" [routerLink]="routes.quotationList">{{
          "Cancel" | translate
        }}</a>
      </div>
    </div>
  </div>
</div>
<!-- /add -->
